; (function () {
  $(".slider__about-menu").mouseover(e => {
    const $this = $(e.currentTarget);
    const dropdown = $this.find(".slider__dropdown");

    $this.addClass("slider__about-menu--active");
    dropdown.addClass("dropdown--active");
  });

  $(".slider__about-menu").mouseout(e => {
    const $this = $(e.currentTarget);
    const dropdown = $this.find(".slider__dropdown");

    $this.removeClass("slider__about-menu--active");
    dropdown.removeClass("dropdown--active");
  });
})();; (function () {
  let myMap;
  const init = () => {
    myMap = new ymaps.Map("map", {
      center: [55.752761, 37.593950],
      zoom: 14,
      controls: [],
    });

    let coords = [
      [55.758657, 37.582835],
      [55.743057, 37.581770],
      [55.750232, 37.603689],
      [55.754585, 37.625343],
    ],
      myCollection = new ymaps.GeoObjectCollection({}, {
        draggable: false,
        iconLayout: 'default#image',
        iconImageHref: './img/icons/marker.svg',
        iconImageSize: [46, 57],
        iconImageOffset: [-35, -52]
      });

    for (let i = 0; i < coords.length; i++) {
      myCollection.add(new ymaps.Placemark(coords[i]));
    }

    myMap.geoObjects.add(myCollection);

    myMap.behaviors.disable('scrollZoom');
  };

  ymaps.ready(init);
})();; (function () {
  const blockWidth = item => {
    let itemWidth = 0;
    const screenWidth = $(window).width();
    const container = item.closest(".products-menu");
    const titlesBlocks = container.find(".products-menu__title");
    const titlesWidth = titlesBlocks.width() * titlesBlocks.length;

    const textContainer = item.find(".products-menu__container");
    const paddingLeft = parseInt(textContainer.css("padding-left"));
    const paddingRight = parseInt(textContainer.css("padding-right"));

    const isMobile = window.matchMedia("(max-width: 768px)").matches;

    if (isMobile) {
      itemWidth = screenWidth - titlesWidth;
    } else {
      itemWidth = 500;
    }

    return {
      container: itemWidth,
      textContainer: itemWidth - paddingRight - paddingLeft
    }
  }

  const closeAllMenuItem = container => {
    const items = container.find(".products-menu__item");
    const content = container.find(".products-menu__content");

    items.removeClass("active");
    content.width(0);
  }

  const openProductMenuItem = item => {
    const hiddenContent = item.find(".products-menu__content");
    const w = blockWidth(item);
    const textBlock = item.find(".products-menu__container");

    item.addClass("active");
    hiddenContent.width(w.container);
    textBlock.width(w.textContainer);
  }

  $(".products-menu__title").click(e => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const item = $this.closest(".products-menu__item");
    const itemOpened = item.hasClass("active");
    const container = $this.closest(".products-menu");

    if (itemOpened) {
      closeAllMenuItem(container);
    } else {
      closeAllMenuItem(container);
      openProductMenuItem(item);
    }
  });
})();; (function () {
  const validateField = (form, fieldsArray) => {
    fieldsArray.forEach(field => {
      field.removeClass("input-error");
      if (field.val().trim() === "") {
        field.addClass("input-error");
      }
    });

    const errorFields = form.find(".input-error");
    return errorFields.length === 0;
  }

  $(".form").submit(e => {
    e.preventDefault();

    const form = $(e.currentTarget);
    const name = form.find("[name='name']");
    const phone = form.find("[name='phone']");
    const comment = form.find("[name='comment']");
    const to = form.find("[name='to']");

    const modal = $("#modal");
    const content = modal.find(".modal__content");
    content.removeClass("error-modal");

    const isValid = validateField(form, [name, phone, comment, to]);

    if (isValid) {
      const request = $.ajax({
        url: "https://webdev-api.loftschool.com/sendmail",
        method: "post",
        data: {
          name: name.val(),
          phone: phone.val(),
          comment: comment.val(),
          to: to.val()
        }
      });

      request.done((data) => {
        content.text(data.message);
      });

      request.fail((data) => {
        const message = data.responseJSON.message;
        content.text(message);
        content.addClass("error-modal");
      });

      request.always(() => {
        $.fancybox.open({
          src: "#modal",
          type: "inline"
        });
      })
    }

  });

  $(".app-submit-modal").click(e => {
    e.preventDefault();

    $.fancybox.close();
  });
})();; (function () {
  const sections = $("section");
  const display = $(".maincontent");
  const sideMenu = $(".fixed-menu");
  const menuItems = sideMenu.find(".fixed-menu__item");

  const mobileDetect = new MobileDetect(window.navigator.userAgent);
  const isMobile = mobileDetect.mobile();

  let inScroll = false;

  sections.first().addClass("active");

  const countSectionPosition = sectionEq => {
    const position = sectionEq * -100;

    if (isNaN(position)) {
      console.error("Передано не верное значение в countSectionPosition");
      return 0;
    }
    return position;
  }

  const changeMenuThemeForSection = sectionEq => {
    const currentSection = sections.eq(sectionEq);
    const menuTheme = currentSection.attr("data-sidemenu-theme");
    const activeClass = "fixed-menu--black";

    if (menuTheme === "black") {
      sideMenu.addClass(activeClass);
    } else {
      sideMenu.removeClass(activeClass);
    }
  }

  const resetActiveClassForItem = (items, itemEq, activeClass) => {
    items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
  }

  const performTransition = sectionEq => {
    if (inScroll) return;
    inScroll = true;

    const transitionOver = 1000;
    const mouseInertiaOver = 300;

    const position = countSectionPosition(sectionEq);

    changeMenuThemeForSection(sectionEq);

    display.css({
      transform: `translateY(${position}%)`
    });

    resetActiveClassForItem(sections, sectionEq, "active");
    resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");

    setTimeout(() => {
      inScroll = false;
    }, transitionOver + mouseInertiaOver);
  }

  const viewportScroller = () => {
    const activeSection = sections.filter(".active");
    const nextSection = activeSection.next();
    const prevSection = activeSection.prev();

    return {
      next() {
        if (nextSection.length) {
          performTransition(nextSection.index())
        }
      },
      prev() {
        if (prevSection.length) {
          performTransition(prevSection.index())
        }
      }
    }
  }

  $(window).on("wheel", e => {
    const deltaY = e.originalEvent.deltaY;
    const scroller = viewportScroller();

    if (deltaY > 0) {
      scroller.next();
    } else if (deltaY < 0) {
      scroller.prev();
    }
  })

  $(window).on("keydown", e => {
    const tagName = e.target.tagName.toLowerCase();
    const userTypingInInputs = tagName === "input" || tagName === "textarea";
    const scroller = viewportScroller();

    if (userTypingInInputs) return;
    switch (e.keyCode) {
      case 38:
        scroller.prev();
        break;

      case 40:
        scroller.next();
        break;
    }
  })

  $(".wrapper").on("touchmove", e => e.preventDefault());

  $("[data-scroll-to]").click(e => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const target = $this.attr("data-scroll-to");
    const reqSection = $(`[data-section-id=${target}]`);

    performTransition(reqSection.index());
  })

  if (isMobile) {
    //  https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
    $("body").swipe({
      swipe: function (event, direction) {
        const scroller = viewportScroller();
        let scrollDirection = "";

        if (direction === "up") scrollDirection = "next";
        if (direction === "down") scrollDirection = "prev";

        if (scrollDirection !== "") scroller[scrollDirection]();
      }
    })
  }
})()
;; (function () {
  const hamburger = document.querySelector(".hamburger");
  const overlay = document.querySelector(".overlay");
  const body = document.querySelector("body");
  const fixedMenu = document.querySelector(".fixed-menu");
  const links = $(".overlay-menu__link");

  hamburger.addEventListener("click", e => {
    e.preventDefault();

    hamburger.classList.toggle("hamburger--active");
    overlay.classList.toggle("overlay--active");
    body.classList.toggle("body--active");
    fixedMenu.classList.toggle("fixed-menu--hidden");
  });

  $(links).each((link) => {
    links.click(e => {
      $(".overlay").removeClass("overlay--active");
      $(body).removeClass("body--active");
      $(".hamburger").removeClass("hamburger--active");
      $(".fixed-menu").removeClass("fixed-menu--hidden");
    });
  });
})();/* ; (function () { */
let player;

const playerContainer = $(".player");

let eventsInit = () => {
  $(".player__start").click(e => {
    e.preventDefault();

    if (playerContainer.hasClass("paused")) {
      player.pauseVideo();
    } else {
      player.playVideo();
    }
  });

  $(".player__playback").click(e => {
    const bar = $(e.currentTarget);
    const clickedPosition = e.originalEvent.layerX;
    const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
    const newPlaybackPositionSec =
      (player.getDuration() / 100) * newButtonPositionPercent;

    $(".player__playback-button").css({
      left: `${newButtonPositionPercent}%`
    });

    player.seekTo(newPlaybackPositionSec);
  });

  $(".player__splash").click(e => {
    player.playVideo();
  })
};

const formatTime = timeSec => {
  const roundTime = Math.round(timeSec);

  const minutes = addZero(Math.floor(roundTime / 60));
  const seconds = addZero(roundTime - minutes * 60);

  function addZero(num) {
    return num < 10 ? `0${num}` : num;
  }

  return `${minutes} : ${seconds}`;
};

const onPlayerReady = () => {
  let interval;
  const durationSec = player.getDuration();

  $(".player__duration-estimate").text(formatTime(durationSec));

  if (typeof interval !== "undefined") {
    clearInterval(interval);
  }

  interval = setInterval(() => {
    const completedSec = player.getCurrentTime();
    const completedPercent = (completedSec / durationSec) * 100;

    $(".player__playback-button").css({
      left: `${completedPercent}%`
    });

    $(".player__duration-completed").text(formatTime(completedSec));
  }, 1000);
};

const onPlayerStateChange = event => {
  /*
    -1 (воспроизведение видео не начато)
    0 (воспроизведение видео завершено)
    1 (воспроизведение)
    2 (пауза)
    3 (буферизация)
    5 (видео подают реплики).
  */
  switch (event.data) {
    case 1:
      playerContainer.addClass("active");
      playerContainer.addClass("paused");
      break;

    case 2:
      playerContainer.removeClass("active");
      playerContainer.removeClass("paused");
      break;
  }
};

function onYouTubeIframeAPIReady() {
  player = new YT.Player("yt-player", {
    height: "392",
    width: "662",
    videoId: "6eHN3daGoYQ",
    events: {
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange
    },
    playerVars: {
      controls: 0,
      disablekb: 0,
      showinfo: 0,
      rel: 0,
      autoplay: 0,
      modestbranding: 0
    }
  });
}

eventsInit();

const mute = $('.player__mute');
const MAX_VOLUME = 100;
let soundLevel;

$('.player__volume-button').css({
  left: `${MAX_VOLUME}%`
});

$('.player__volume').click((e) => {
  const barVolume = $(e.currentTarget);
  const clickedVolumePosition = e.originalEvent.layerX;
  const newVolumePositionPercent = (clickedVolumePosition / barVolume.width()) * 100;
  const newSoundPosition = player.setVolume(newVolumePositionPercent);

  $('.player__volume-button').css({
    left: `${newVolumePositionPercent}%`
  });

  player.setVolume(newSoundPosition);
});

$(mute).click(e => {

  if (player.isMuted()) {
    $('.player__volume-button').css({
      left: `${soundLevel}%`
    });
    player.unMute();
  } else {
    soundLevel = player.getVolume();
    $('.player__volume-button').css({
      left: `0`
    });
    player.mute();
  }
});
/* })() */;; (function () {
  const findBlockByAlias = (alias) => {
    return $(".reviews__item").filter((idx, item) => {
      return $(item).attr("data-linked") === alias;
    });
  }

  $(".interactive-avatar__link").click(e => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const parent = $this.closest(".interactive-avatar");
    parent.addClass("active").siblings().removeClass("active");

    const target = $this.attr("data-open");
    const displayedItem = findBlockByAlias(target);
    displayedItem.addClass("active").siblings().removeClass("active");
  })
})()

;; (function () {
  const slider = $(".slider__list").bxSlider({
    pager: false,
    controls: false,
  });

  $('.arrow-right').click(e => {
    e.preventDefault();

    slider.goToNextSlide();
  });

  $('.arrow-left').click(e => {
    e.preventDefault();

    slider.goToPrevSlide();
  });
})();; (function () {
  const openItem = item => {
    const container = item.closest(".person");
    const content = container.find(".person__content");
    const contentBlock = content.find(".person__content-block");
    const contentBlockHeight = contentBlock.height();
    const triangle = container.find(".triangle");

    container.addClass("active");
    triangle.addClass("active");
    content.height(contentBlockHeight);
  }

  const closeAll = container => {
    const items = container.find(".person__content");
    const itemContainer = container.find(".person");
    const triangle = itemContainer.find(".triangle");

    itemContainer.removeClass("active");
    triangle.removeClass("active");
    items.height(0);
  }

  $(".person__name").click(e => {
    const $this = $(e.currentTarget);
    const container = $this.closest(".team");
    const itemContainer = $this.closest(".person");


    if (itemContainer.hasClass("active")) {
      closeAll(container);
    } else {
      closeAll(container);
      openItem($this);
    }
  })
})()
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbmR5LWRyb3Bkb3duLmpzIiwibWFwLmpzIiwibWVudS1hY2NvLmpzIiwibW9kYWwuanMiLCJvcHMuanMiLCJvdmVybGF5LW1lbnUuanMiLCJwbGF5ZXIuanMiLCJyZXZpZXdzLmpzIiwic2xpZGVyLmpzIiwidGVhbS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0NqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQ3RKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiOyAoZnVuY3Rpb24gKCkge1xyXG4gICQoXCIuc2xpZGVyX19hYm91dC1tZW51XCIpLm1vdXNlb3ZlcihlID0+IHtcclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgZHJvcGRvd24gPSAkdGhpcy5maW5kKFwiLnNsaWRlcl9fZHJvcGRvd25cIik7XHJcblxyXG4gICAgJHRoaXMuYWRkQ2xhc3MoXCJzbGlkZXJfX2Fib3V0LW1lbnUtLWFjdGl2ZVwiKTtcclxuICAgIGRyb3Bkb3duLmFkZENsYXNzKFwiZHJvcGRvd24tLWFjdGl2ZVwiKTtcclxuICB9KTtcclxuXHJcbiAgJChcIi5zbGlkZXJfX2Fib3V0LW1lbnVcIikubW91c2VvdXQoZSA9PiB7XHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IGRyb3Bkb3duID0gJHRoaXMuZmluZChcIi5zbGlkZXJfX2Ryb3Bkb3duXCIpO1xyXG5cclxuICAgICR0aGlzLnJlbW92ZUNsYXNzKFwic2xpZGVyX19hYm91dC1tZW51LS1hY3RpdmVcIik7XHJcbiAgICBkcm9wZG93bi5yZW1vdmVDbGFzcyhcImRyb3Bkb3duLS1hY3RpdmVcIik7XHJcbiAgfSk7XHJcbn0pKCkiLCI7IChmdW5jdGlvbiAoKSB7XHJcbiAgbGV0IG15TWFwO1xyXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiAgICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICAgICBjZW50ZXI6IFs1NS43NTI3NjEsIDM3LjU5Mzk1MF0sXHJcbiAgICAgIHpvb206IDE0LFxyXG4gICAgICBjb250cm9sczogW10sXHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgY29vcmRzID0gW1xyXG4gICAgICBbNTUuNzU4NjU3LCAzNy41ODI4MzVdLFxyXG4gICAgICBbNTUuNzQzMDU3LCAzNy41ODE3NzBdLFxyXG4gICAgICBbNTUuNzUwMjMyLCAzNy42MDM2ODldLFxyXG4gICAgICBbNTUuNzU0NTg1LCAzNy42MjUzNDNdLFxyXG4gICAgXSxcclxuICAgICAgbXlDb2xsZWN0aW9uID0gbmV3IHltYXBzLkdlb09iamVjdENvbGxlY3Rpb24oe30sIHtcclxuICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLFxyXG4gICAgICAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcclxuICAgICAgICBpY29uSW1hZ2VIcmVmOiAnLi9pbWcvaWNvbnMvbWFya2VyLnN2ZycsXHJcbiAgICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N10sXHJcbiAgICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTM1LCAtNTJdXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZHNbaV0pKTtcclxuICAgIH1cclxuXHJcbiAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG5cclxuICAgIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdzY3JvbGxab29tJyk7XHJcbiAgfTtcclxuXHJcbiAgeW1hcHMucmVhZHkoaW5pdCk7XHJcbn0pKCkiLCI7IChmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3QgYmxvY2tXaWR0aCA9IGl0ZW0gPT4ge1xyXG4gICAgbGV0IGl0ZW1XaWR0aCA9IDA7XHJcbiAgICBjb25zdCBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnByb2R1Y3RzLW1lbnVcIik7XHJcbiAgICBjb25zdCB0aXRsZXNCbG9ja3MgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0cy1tZW51X190aXRsZVwiKTtcclxuICAgIGNvbnN0IHRpdGxlc1dpZHRoID0gdGl0bGVzQmxvY2tzLndpZHRoKCkgKiB0aXRsZXNCbG9ja3MubGVuZ3RoO1xyXG5cclxuICAgIGNvbnN0IHRleHRDb250YWluZXIgPSBpdGVtLmZpbmQoXCIucHJvZHVjdHMtbWVudV9fY29udGFpbmVyXCIpO1xyXG4gICAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XHJcbiAgICBjb25zdCBwYWRkaW5nUmlnaHQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctcmlnaHRcIikpO1xyXG5cclxuICAgIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA3NjhweClcIikubWF0Y2hlcztcclxuXHJcbiAgICBpZiAoaXNNb2JpbGUpIHtcclxuICAgICAgaXRlbVdpZHRoID0gc2NyZWVuV2lkdGggLSB0aXRsZXNXaWR0aDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGl0ZW1XaWR0aCA9IDUwMDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBjb250YWluZXI6IGl0ZW1XaWR0aCxcclxuICAgICAgdGV4dENvbnRhaW5lcjogaXRlbVdpZHRoIC0gcGFkZGluZ1JpZ2h0IC0gcGFkZGluZ0xlZnRcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IGNsb3NlQWxsTWVudUl0ZW0gPSBjb250YWluZXIgPT4ge1xyXG4gICAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0cy1tZW51X19pdGVtXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKFwiLnByb2R1Y3RzLW1lbnVfX2NvbnRlbnRcIik7XHJcblxyXG4gICAgaXRlbXMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBjb250ZW50LndpZHRoKDApO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgb3BlblByb2R1Y3RNZW51SXRlbSA9IGl0ZW0gPT4ge1xyXG4gICAgY29uc3QgaGlkZGVuQ29udGVudCA9IGl0ZW0uZmluZChcIi5wcm9kdWN0cy1tZW51X19jb250ZW50XCIpO1xyXG4gICAgY29uc3QgdyA9IGJsb2NrV2lkdGgoaXRlbSk7XHJcbiAgICBjb25zdCB0ZXh0QmxvY2sgPSBpdGVtLmZpbmQoXCIucHJvZHVjdHMtbWVudV9fY29udGFpbmVyXCIpO1xyXG5cclxuICAgIGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBoaWRkZW5Db250ZW50LndpZHRoKHcuY29udGFpbmVyKTtcclxuICAgIHRleHRCbG9jay53aWR0aCh3LnRleHRDb250YWluZXIpO1xyXG4gIH1cclxuXHJcbiAgJChcIi5wcm9kdWN0cy1tZW51X190aXRsZVwiKS5jbGljayhlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IGl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLnByb2R1Y3RzLW1lbnVfX2l0ZW1cIik7XHJcbiAgICBjb25zdCBpdGVtT3BlbmVkID0gaXRlbS5oYXNDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIucHJvZHVjdHMtbWVudVwiKTtcclxuXHJcbiAgICBpZiAoaXRlbU9wZW5lZCkge1xyXG4gICAgICBjbG9zZUFsbE1lbnVJdGVtKGNvbnRhaW5lcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjbG9zZUFsbE1lbnVJdGVtKGNvbnRhaW5lcik7XHJcbiAgICAgIG9wZW5Qcm9kdWN0TWVudUl0ZW0oaXRlbSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pKCkiLCI7IChmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3QgdmFsaWRhdGVGaWVsZCA9IChmb3JtLCBmaWVsZHNBcnJheSkgPT4ge1xyXG4gICAgZmllbGRzQXJyYXkuZm9yRWFjaChmaWVsZCA9PiB7XHJcbiAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT09IFwiXCIpIHtcclxuICAgICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZChcIi5pbnB1dC1lcnJvclwiKTtcclxuICAgIHJldHVybiBlcnJvckZpZWxkcy5sZW5ndGggPT09IDA7XHJcbiAgfVxyXG5cclxuICAkKFwiLmZvcm1cIikuc3VibWl0KGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGNvbnN0IGZvcm0gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICAgIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XHJcbiAgICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiW25hbWU9J2NvbW1lbnQnXVwiKTtcclxuICAgIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcblxyXG4gICAgY29uc3QgbW9kYWwgPSAkKFwiI21vZGFsXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IG1vZGFsLmZpbmQoXCIubW9kYWxfX2NvbnRlbnRcIik7XHJcbiAgICBjb250ZW50LnJlbW92ZUNsYXNzKFwiZXJyb3ItbW9kYWxcIik7XHJcblxyXG4gICAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGQoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG5cclxuICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuICAgICAgICBtZXRob2Q6IFwicG9zdFwiLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIG5hbWU6IG5hbWUudmFsKCksXHJcbiAgICAgICAgICBwaG9uZTogcGhvbmUudmFsKCksXHJcbiAgICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgICAgdG86IHRvLnZhbCgpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlcXVlc3QuZG9uZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xyXG4gICAgICAgIGNvbnRlbnQudGV4dChtZXNzYWdlKTtcclxuICAgICAgICBjb250ZW50LmFkZENsYXNzKFwiZXJyb3ItbW9kYWxcIik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICBzcmM6IFwiI21vZGFsXCIsXHJcbiAgICAgICAgICB0eXBlOiBcImlubGluZVwiXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gIH0pO1xyXG5cclxuICAkKFwiLmFwcC1zdWJtaXQtbW9kYWxcIikuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG4gIH0pO1xyXG59KSgpIiwiOyAoZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbiAgY29uc3QgZGlzcGxheSA9ICQoXCIubWFpbmNvbnRlbnRcIik7XHJcbiAgY29uc3Qgc2lkZU1lbnUgPSAkKFwiLmZpeGVkLW1lbnVcIik7XHJcbiAgY29uc3QgbWVudUl0ZW1zID0gc2lkZU1lbnUuZmluZChcIi5maXhlZC1tZW51X19pdGVtXCIpO1xyXG5cclxuICBjb25zdCBtb2JpbGVEZXRlY3QgPSBuZXcgTW9iaWxlRGV0ZWN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcclxuICBjb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcclxuXHJcbiAgbGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG4gIHNlY3Rpb25zLmZpcnN0KCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcblxyXG4gIGNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgIGNvbnN0IHBvc2l0aW9uID0gc2VjdGlvbkVxICogLTEwMDtcclxuXHJcbiAgICBpZiAoaXNOYU4ocG9zaXRpb24pKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLQn9C10YDQtdC00LDQvdC+INC90LUg0LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBvc2l0aW9uO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgICBjb25zdCBjdXJyZW50U2VjdGlvbiA9IHNlY3Rpb25zLmVxKHNlY3Rpb25FcSk7XHJcbiAgICBjb25zdCBtZW51VGhlbWUgPSBjdXJyZW50U2VjdGlvbi5hdHRyKFwiZGF0YS1zaWRlbWVudS10aGVtZVwiKTtcclxuICAgIGNvbnN0IGFjdGl2ZUNsYXNzID0gXCJmaXhlZC1tZW51LS1ibGFja1wiO1xyXG5cclxuICAgIGlmIChtZW51VGhlbWUgPT09IFwiYmxhY2tcIikge1xyXG4gICAgICBzaWRlTWVudS5hZGRDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbSA9IChpdGVtcywgaXRlbUVxLCBhY3RpdmVDbGFzcykgPT4ge1xyXG4gICAgaXRlbXMuZXEoaXRlbUVxKS5hZGRDbGFzcyhhY3RpdmVDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgICBpZiAoaW5TY3JvbGwpIHJldHVybjtcclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCB0cmFuc2l0aW9uT3ZlciA9IDEwMDA7XHJcbiAgICBjb25zdCBtb3VzZUluZXJ0aWFPdmVyID0gMzAwO1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uID0gY291bnRTZWN0aW9uUG9zaXRpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgICBjaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gICAgZGlzcGxheS5jc3Moe1xyXG4gICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259JSlgXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZVwiKTtcclxuICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuICAgIH0sIHRyYW5zaXRpb25PdmVyICsgbW91c2VJbmVydGlhT3Zlcik7XHJcbiAgfVxyXG5cclxuICBjb25zdCB2aWV3cG9ydFNjcm9sbGVyID0gKCkgPT4ge1xyXG4gICAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7XHJcbiAgICBjb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xyXG4gICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuZXh0KCkge1xyXG4gICAgICAgIGlmIChuZXh0U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBwcmV2KCkge1xyXG4gICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAkKHdpbmRvdykub24oXCJ3aGVlbFwiLCBlID0+IHtcclxuICAgIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbiAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbiAgICBpZiAoZGVsdGFZID4gMCkge1xyXG4gICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gICQod2luZG93KS5vbihcImtleWRvd25cIiwgZSA9PiB7XHJcbiAgICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgY29uc3QgdXNlclR5cGluZ0luSW5wdXRzID0gdGFnTmFtZSA9PT0gXCJpbnB1dFwiIHx8IHRhZ05hbWUgPT09IFwidGV4dGFyZWFcIjtcclxuICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICAgIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgIGNhc2UgMzg6XHJcbiAgICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSA0MDpcclxuICAgICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgJChcIi53cmFwcGVyXCIpLm9uKFwidG91Y2htb3ZlXCIsIGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuXHJcbiAgJChcIltkYXRhLXNjcm9sbC10b11cIikuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XHJcbiAgICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZD0ke3RhcmdldH1dYCk7XHJcblxyXG4gICAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxuICB9KVxyXG5cclxuICBpZiAoaXNNb2JpbGUpIHtcclxuICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vbWF0dGJyeXNvbi9Ub3VjaFN3aXBlLUpxdWVyeS1QbHVnaW5cclxuICAgICQoXCJib2R5XCIpLnN3aXBlKHtcclxuICAgICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbiAgICAgICAgbGV0IHNjcm9sbERpcmVjdGlvbiA9IFwiXCI7XHJcblxyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJkb3duXCIpIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiO1xyXG5cclxuICAgICAgICBpZiAoc2Nyb2xsRGlyZWN0aW9uICE9PSBcIlwiKSBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG59KSgpXHJcbiIsIjsgKGZ1bmN0aW9uICgpIHtcclxuICBjb25zdCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmhhbWJ1cmdlclwiKTtcclxuICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5vdmVybGF5XCIpO1xyXG4gIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keVwiKTtcclxuICBjb25zdCBmaXhlZE1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZpeGVkLW1lbnVcIik7XHJcbiAgY29uc3QgbGlua3MgPSAkKFwiLm92ZXJsYXktbWVudV9fbGlua1wiKTtcclxuXHJcbiAgaGFtYnVyZ2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBoYW1idXJnZXIuY2xhc3NMaXN0LnRvZ2dsZShcImhhbWJ1cmdlci0tYWN0aXZlXCIpO1xyXG4gICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKFwib3ZlcmxheS0tYWN0aXZlXCIpO1xyXG4gICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKFwiYm9keS0tYWN0aXZlXCIpO1xyXG4gICAgZml4ZWRNZW51LmNsYXNzTGlzdC50b2dnbGUoXCJmaXhlZC1tZW51LS1oaWRkZW5cIik7XHJcbiAgfSk7XHJcblxyXG4gICQobGlua3MpLmVhY2goKGxpbmspID0+IHtcclxuICAgIGxpbmtzLmNsaWNrKGUgPT4ge1xyXG4gICAgICAkKFwiLm92ZXJsYXlcIikucmVtb3ZlQ2xhc3MoXCJvdmVybGF5LS1hY3RpdmVcIik7XHJcbiAgICAgICQoYm9keSkucmVtb3ZlQ2xhc3MoXCJib2R5LS1hY3RpdmVcIik7XHJcbiAgICAgICQoXCIuaGFtYnVyZ2VyXCIpLnJlbW92ZUNsYXNzKFwiaGFtYnVyZ2VyLS1hY3RpdmVcIik7XHJcbiAgICAgICQoXCIuZml4ZWQtbWVudVwiKS5yZW1vdmVDbGFzcyhcImZpeGVkLW1lbnUtLWhpZGRlblwiKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KSgpIiwiLyogOyAoZnVuY3Rpb24gKCkgeyAqL1xyXG5sZXQgcGxheWVyO1xyXG5cclxuY29uc3QgcGxheWVyQ29udGFpbmVyID0gJChcIi5wbGF5ZXJcIik7XHJcblxyXG5sZXQgZXZlbnRzSW5pdCA9ICgpID0+IHtcclxuICAkKFwiLnBsYXllcl9fc3RhcnRcIikuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgaWYgKHBsYXllckNvbnRhaW5lci5oYXNDbGFzcyhcInBhdXNlZFwiKSkge1xyXG4gICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAkKFwiLnBsYXllcl9fcGxheWJhY2tcIikuY2xpY2soZSA9PiB7XHJcbiAgICBjb25zdCBiYXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBjbGlja2VkUG9zaXRpb24gPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xyXG4gICAgY29uc3QgbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50ID0gKGNsaWNrZWRQb3NpdGlvbiAvIGJhci53aWR0aCgpKSAqIDEwMDtcclxuICAgIGNvbnN0IG5ld1BsYXliYWNrUG9zaXRpb25TZWMgPVxyXG4gICAgICAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50O1xyXG5cclxuICAgICQoXCIucGxheWVyX19wbGF5YmFjay1idXR0b25cIikuY3NzKHtcclxuICAgICAgbGVmdDogYCR7bmV3QnV0dG9uUG9zaXRpb25QZXJjZW50fSVgXHJcbiAgICB9KTtcclxuXHJcbiAgICBwbGF5ZXIuc2Vla1RvKG5ld1BsYXliYWNrUG9zaXRpb25TZWMpO1xyXG4gIH0pO1xyXG5cclxuICAkKFwiLnBsYXllcl9fc3BsYXNoXCIpLmNsaWNrKGUgPT4ge1xyXG4gICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4gIH0pXHJcbn07XHJcblxyXG5jb25zdCBmb3JtYXRUaW1lID0gdGltZVNlYyA9PiB7XHJcbiAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbiAgY29uc3QgbWludXRlcyA9IGFkZFplcm8oTWF0aC5mbG9vcihyb3VuZFRpbWUgLyA2MCkpO1xyXG4gIGNvbnN0IHNlY29uZHMgPSBhZGRaZXJvKHJvdW5kVGltZSAtIG1pbnV0ZXMgKiA2MCk7XHJcblxyXG4gIGZ1bmN0aW9uIGFkZFplcm8obnVtKSB7XHJcbiAgICByZXR1cm4gbnVtIDwgMTAgPyBgMCR7bnVtfWAgOiBudW07XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYCR7bWludXRlc30gOiAke3NlY29uZHN9YDtcclxufTtcclxuXHJcbmNvbnN0IG9uUGxheWVyUmVhZHkgPSAoKSA9PiB7XHJcbiAgbGV0IGludGVydmFsO1xyXG4gIGNvbnN0IGR1cmF0aW9uU2VjID0gcGxheWVyLmdldER1cmF0aW9uKCk7XHJcblxyXG4gICQoXCIucGxheWVyX19kdXJhdGlvbi1lc3RpbWF0ZVwiKS50ZXh0KGZvcm1hdFRpbWUoZHVyYXRpb25TZWMpKTtcclxuXHJcbiAgaWYgKHR5cGVvZiBpbnRlcnZhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgfVxyXG5cclxuICBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgIGNvbnN0IGNvbXBsZXRlZFNlYyA9IHBsYXllci5nZXRDdXJyZW50VGltZSgpO1xyXG4gICAgY29uc3QgY29tcGxldGVkUGVyY2VudCA9IChjb21wbGV0ZWRTZWMgLyBkdXJhdGlvblNlYykgKiAxMDA7XHJcblxyXG4gICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xyXG4gICAgICBsZWZ0OiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgXHJcbiAgICB9KTtcclxuXHJcbiAgICAkKFwiLnBsYXllcl9fZHVyYXRpb24tY29tcGxldGVkXCIpLnRleHQoZm9ybWF0VGltZShjb21wbGV0ZWRTZWMpKTtcclxuICB9LCAxMDAwKTtcclxufTtcclxuXHJcbmNvbnN0IG9uUGxheWVyU3RhdGVDaGFuZ2UgPSBldmVudCA9PiB7XHJcbiAgLypcclxuICAgIC0xICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUg0LLQuNC00LXQviDQvdC1INC90LDRh9Cw0YLQvilcclxuICAgIDAgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC30LDQstC10YDRiNC10L3QvilcclxuICAgIDEgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSlcclxuICAgIDIgKNC/0LDRg9C30LApXHJcbiAgICAzICjQsdGD0YTQtdGA0LjQt9Cw0YbQuNGPKVxyXG4gICAgNSAo0LLQuNC00LXQviDQv9C+0LTQsNGO0YIg0YDQtdC/0LvQuNC60LgpLlxyXG4gICovXHJcbiAgc3dpdGNoIChldmVudC5kYXRhKSB7XHJcbiAgICBjYXNlIDE6XHJcbiAgICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgcGxheWVyQ29udGFpbmVyLmFkZENsYXNzKFwicGF1c2VkXCIpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIDI6XHJcbiAgICAgIHBsYXllckNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgcGxheWVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicGF1c2VkXCIpO1xyXG4gICAgICBicmVhaztcclxuICB9XHJcbn07XHJcblxyXG5mdW5jdGlvbiBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSgpIHtcclxuICBwbGF5ZXIgPSBuZXcgWVQuUGxheWVyKFwieXQtcGxheWVyXCIsIHtcclxuICAgIGhlaWdodDogXCIzOTJcIixcclxuICAgIHdpZHRoOiBcIjY2MlwiLFxyXG4gICAgdmlkZW9JZDogXCI2ZUhOM2RhR29ZUVwiLFxyXG4gICAgZXZlbnRzOiB7XHJcbiAgICAgIG9uUmVhZHk6IG9uUGxheWVyUmVhZHksXHJcbiAgICAgIG9uU3RhdGVDaGFuZ2U6IG9uUGxheWVyU3RhdGVDaGFuZ2VcclxuICAgIH0sXHJcbiAgICBwbGF5ZXJWYXJzOiB7XHJcbiAgICAgIGNvbnRyb2xzOiAwLFxyXG4gICAgICBkaXNhYmxla2I6IDAsXHJcbiAgICAgIHNob3dpbmZvOiAwLFxyXG4gICAgICByZWw6IDAsXHJcbiAgICAgIGF1dG9wbGF5OiAwLFxyXG4gICAgICBtb2Rlc3RicmFuZGluZzogMFxyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5ldmVudHNJbml0KCk7XHJcblxyXG5jb25zdCBtdXRlID0gJCgnLnBsYXllcl9fbXV0ZScpO1xyXG5jb25zdCBNQVhfVk9MVU1FID0gMTAwO1xyXG5sZXQgc291bmRMZXZlbDtcclxuXHJcbiQoJy5wbGF5ZXJfX3ZvbHVtZS1idXR0b24nKS5jc3Moe1xyXG4gIGxlZnQ6IGAke01BWF9WT0xVTUV9JWBcclxufSk7XHJcblxyXG4kKCcucGxheWVyX192b2x1bWUnKS5jbGljaygoZSkgPT4ge1xyXG4gIGNvbnN0IGJhclZvbHVtZSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBjbGlja2VkVm9sdW1lUG9zaXRpb24gPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xyXG4gIGNvbnN0IG5ld1ZvbHVtZVBvc2l0aW9uUGVyY2VudCA9IChjbGlja2VkVm9sdW1lUG9zaXRpb24gLyBiYXJWb2x1bWUud2lkdGgoKSkgKiAxMDA7XHJcbiAgY29uc3QgbmV3U291bmRQb3NpdGlvbiA9IHBsYXllci5zZXRWb2x1bWUobmV3Vm9sdW1lUG9zaXRpb25QZXJjZW50KTtcclxuXHJcbiAgJCgnLnBsYXllcl9fdm9sdW1lLWJ1dHRvbicpLmNzcyh7XHJcbiAgICBsZWZ0OiBgJHtuZXdWb2x1bWVQb3NpdGlvblBlcmNlbnR9JWBcclxuICB9KTtcclxuXHJcbiAgcGxheWVyLnNldFZvbHVtZShuZXdTb3VuZFBvc2l0aW9uKTtcclxufSk7XHJcblxyXG4kKG11dGUpLmNsaWNrKGUgPT4ge1xyXG5cclxuICBpZiAocGxheWVyLmlzTXV0ZWQoKSkge1xyXG4gICAgJCgnLnBsYXllcl9fdm9sdW1lLWJ1dHRvbicpLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGAke3NvdW5kTGV2ZWx9JWBcclxuICAgIH0pO1xyXG4gICAgcGxheWVyLnVuTXV0ZSgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzb3VuZExldmVsID0gcGxheWVyLmdldFZvbHVtZSgpO1xyXG4gICAgJCgnLnBsYXllcl9fdm9sdW1lLWJ1dHRvbicpLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGAwYFxyXG4gICAgfSk7XHJcbiAgICBwbGF5ZXIubXV0ZSgpO1xyXG4gIH1cclxufSk7XHJcbi8qIH0pKCkgKi8iLCI7IChmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3QgZmluZEJsb2NrQnlBbGlhcyA9IChhbGlhcykgPT4ge1xyXG4gICAgcmV0dXJuICQoXCIucmV2aWV3c19faXRlbVwiKS5maWx0ZXIoKGlkeCwgaXRlbSkgPT4ge1xyXG4gICAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1saW5rZWRcIikgPT09IGFsaWFzO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAkKFwiLmludGVyYWN0aXZlLWF2YXRhcl9fbGlua1wiKS5jbGljayhlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IHBhcmVudCA9ICR0aGlzLmNsb3Nlc3QoXCIuaW50ZXJhY3RpdmUtYXZhdGFyXCIpO1xyXG4gICAgcGFyZW50LmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcblxyXG4gICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcclxuICAgIGNvbnN0IGRpc3BsYXllZEl0ZW0gPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbiAgICBkaXNwbGF5ZWRJdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgfSlcclxufSkoKVxyXG5cclxuIiwiOyAoZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IHNsaWRlciA9ICQoXCIuc2xpZGVyX19saXN0XCIpLmJ4U2xpZGVyKHtcclxuICAgIHBhZ2VyOiBmYWxzZSxcclxuICAgIGNvbnRyb2xzOiBmYWxzZSxcclxuICB9KTtcclxuXHJcbiAgJCgnLmFycm93LXJpZ2h0JykuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxuICB9KTtcclxuXHJcbiAgJCgnLmFycm93LWxlZnQnKS5jbGljayhlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBzbGlkZXIuZ29Ub1ByZXZTbGlkZSgpO1xyXG4gIH0pO1xyXG59KSgpIiwiOyAoZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IG9wZW5JdGVtID0gaXRlbSA9PiB7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSBpdGVtLmNsb3Nlc3QoXCIucGVyc29uXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKFwiLnBlcnNvbl9fY29udGVudFwiKTtcclxuICAgIGNvbnN0IGNvbnRlbnRCbG9jayA9IGNvbnRlbnQuZmluZChcIi5wZXJzb25fX2NvbnRlbnQtYmxvY2tcIik7XHJcbiAgICBjb25zdCBjb250ZW50QmxvY2tIZWlnaHQgPSBjb250ZW50QmxvY2suaGVpZ2h0KCk7XHJcbiAgICBjb25zdCB0cmlhbmdsZSA9IGNvbnRhaW5lci5maW5kKFwiLnRyaWFuZ2xlXCIpO1xyXG5cclxuICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgIHRyaWFuZ2xlLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgY29udGVudC5oZWlnaHQoY29udGVudEJsb2NrSGVpZ2h0KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNsb3NlQWxsID0gY29udGFpbmVyID0+IHtcclxuICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIucGVyc29uX19jb250ZW50XCIpO1xyXG4gICAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLnBlcnNvblwiKTtcclxuICAgIGNvbnN0IHRyaWFuZ2xlID0gaXRlbUNvbnRhaW5lci5maW5kKFwiLnRyaWFuZ2xlXCIpO1xyXG5cclxuICAgIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICB0cmlhbmdsZS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgIGl0ZW1zLmhlaWdodCgwKTtcclxuICB9XHJcblxyXG4gICQoXCIucGVyc29uX19uYW1lXCIpLmNsaWNrKGUgPT4ge1xyXG4gICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnRlYW1cIik7XHJcbiAgICBjb25zdCBpdGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5wZXJzb25cIik7XHJcblxyXG5cclxuICAgIGlmIChpdGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XHJcbiAgICAgIGNsb3NlQWxsKGNvbnRhaW5lcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjbG9zZUFsbChjb250YWluZXIpO1xyXG4gICAgICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgICB9XHJcbiAgfSlcclxufSkoKSJdfQ==
